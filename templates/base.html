{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Fast level Bot | login</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <!-- Toastr CSS -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">

        <!-- jQuery -->
        <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    
        <!-- Toastr JavaScript -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
        <script src="/docs/5.3/assets/js/color-modes.js"></script>
        <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
        <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
        <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  </head>

  <style>
    .tooltip-container {
  position: relative;
cursor: pointer;
  display: flex;
}
.tooltip {
  visibility: hidden;
    width: 250px;
    background-color: #333;
    color: #fff;
    text-align: center;
    border-radius: 10px;
    padding: 10px;
    position: absolute;
    z-index: 1;
    bottom: calc(87% + 13px);
    left: 50%;
    transform: translateX(-31%);
    opacity: 0;
    transition: opacity 0.3s, visibility 0s 0.3s;
}

.tooltip:after {
  content: '';
    position: absolute;
    bottom: -10px;
    left: 32%;
    width: 0;
    height: 0;
    border: 10px solid transparent;
    border-top-color: #333;
    border-bottom: 0;
    margin-left: -10px;
}

.tooltip-container:hover .tooltip ,
.tooltip-container:hover .tooltip_totp_advance {
  visibility: visible;
  opacity: 1;
}

    .main_sign_highlight_bottom{
     
        padding: 0 33px !important;
        display: flex;
  justify-content: center; /* Horizontally center the content */
  align-items: center; /* Vertically center the content */
  height: 100vh; /* Adjust height as needed */

    }
    .main_login_inner{
        box-shadow: rgba(17, 12, 46, 0.15) 0px 48px 100px 0px;
        padding: 24px 37px;
    border-radius: 18px;
    display: flex;
    align-items: center;

    flex-direction: column;
}
  </style>
  <body>

<a href="/">Home</a>
    {% if user.is_authenticated %}
 
    <div class="main_notifications_users_dropdown"  >
    
      <div class="dropdown mobile_menu_bar d-md-block ">
        <i class='bx bx-menu text-dark'  style="font-weight: 500; cursor:pointer;    padding: 25px 0;
        font-size: 25px;" data-bs-toggle="offcanvas" data-bs-target="#Algo_trade_mobile_nav" role="button" aria-controls="Algo_trade_mobile_nav" ></i>
      </div>
      <div class="dropdown d-md-none">
        <i type="button" class="bx bx-bell position-relative text-dark" id="notification_bell" data-bs-toggle="dropdown" aria-expanded="false"
          style="font-weight: 500; cursor:pointer;font-size: 22px;     padding: 25px 0;">
    
          <span
            class="position-absolute top-0 start-100 translate-middle  bg-danger border border-light rounded-circle" style="    width: 7px;
            height: 7px;">
            <span class="visually-hidden"></span>
          </span>
        </i>
    
    
        <ul class="dropdown-menu user-mega-menu mt-1 notification-icon overflow-auto" id="notification_dropdown" aria-labelledby="navbarDropdown"
        style="max-height: 473px;">
      <!-- Result data will be dynamically added here -->
    </ul>
    
    <script>
      $(document).ready(function() {
        // Flag to track if the AJAX request has been made
        var ajaxRequested = false;
      
        // Hover event using one() to ensure it triggers only once
        $('#notification_bell').one('mouseenter', function() {
          if (!ajaxRequested) {
            // Make AJAX request to get user_results data
            $.ajax({
              url: '/get_user_strategy_results',  // Replace with your actual API endpoint
              method: 'GET',
              dataType: 'json',
              success: function(response) {
                // Iterate through user_results and display each result_data.message
                var resultsContainer = $('#notification_dropdown');
                $.each(response.user_results, function(index, result) {
                  $.each(result.result_data, function(_, message) {
                    // Remove content after [Read more.](...) including the link
                    var cleanedMessage = JSON.parse(message).message.replace(/\[Read more\..*?\]\([^)]+\)/g, '');
      
                    // Create and append HTML for each result_data.message
                    var listItem = $('<li>').addClass('dropdown-item py-2 cursor-pointer');
                    listItem.append('<div class="d-flex justify-content-between"><span class="pe-5 label-color-4 fw-600" style="font-size: 16px; font-weight: 600;">' +
                      result.strategy_name + '</span><span class="ps-3 label-color-5" style="font-size: 15px;">' +
                      result.scheduled_time + '</span></div><span class="label-color-4 text-wrap" style="font-size: 14px;">' +
                      cleanedMessage.trim() + '</span>');
                    resultsContainer.append(listItem);
                  });
                });
              },
              error: function(error) {
                console.error('Error fetching data:', error);
              },
              complete: function() {
                // Set the flag to true after the AJAX request is complete
                ajaxRequested = true;
              }
            });
          }
        });
      });
      </script>
      </div>
      <div class="dropdown">
        <a class="btn-secondary-user" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false"
          id="dashboard_nav_dropdown_user" style="display: flex; gap: 0.5rem; align-items: center; padding: 17px 0;">
          <h5>
            {% if user.full_name %}
       
              {{ user.full_name }}
              {% elif user.username %}
            {{ user.username }}
          {% else %}
            ADMIN
          {% endif %}
          
          
            
          </h5>
          <!-- <div class="text-black">{{user.full_name}}</div> -->
        </a>
    <style>
      #user_dropdown li:focus{
        all: unset !important;
      }
      .dropdown-item.active, .dropdown-item:active{
        background-color:transparent !important;
        color: black !important;
      }
    
      #user_dropdown li a:hover {
        transition: 0.2s;
        background: rgb(237 163 157 / 10%) !important;
    
    }
      #user_dropdown li a {
        transition: 0.2s;
        color: rgb(88, 88, 88);
    
    }
    .modal_close_btn{
      transition: .3s;
    }
    .modal_close_btn:hover{
    /* background-color: #f2f2f2 !important; */
    background-color: #f1eded !important;
    }
    </style>
        <ul class="dropdown-menu" id="user_dropdown">

    
            <li><a class="dropdown-item" href="{% url 'broker_details' %}">Broker Details </a></li>
    
          <li>
            <hr class="dropdown-divider">
          </li>
          <li><a class="dropdown-item" href="{% url 'logout_user' %}">Logout </a></li>
    
        </ul>
      </div>
    </div>
        
          {% else %}
          <div class="main_not_authenticated_items d-flex gap-3 align-items-center">
        
            <div class="dropdown mobile_menu_bar d-md-block ">
              <i class='bx bx-menu text-dark'  style="font-weight: 500; cursor:pointer;    padding: 14px 0;
              font-size: 31px" data-bs-toggle="offcanvas" data-bs-target="#Algo_trade_mobile_nav" role="button" aria-controls="Algo_trade_mobile_nav" ></i>
            </div>
            <a href="{% url 'signup_page' %}">
              Sign Up</a>
            <a href="{% url 'login_page' %}" > Sign In</a>
          </div>
          {% endif %}
          <!-- <div class="menu_mobile" style="display: none; color: black !important; font-size: 31px;" type="button"
            data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample" aria-controls="offcanvasExample">
            <i class="bi bi-list"></i>
          </div> -->
        </div>



    {% block dashboard_body %}

    <div class="mina" style="height: 100vh;">
  
    </div>
    {% endblock dashboard_body %}











    
    
</body>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>



</html>